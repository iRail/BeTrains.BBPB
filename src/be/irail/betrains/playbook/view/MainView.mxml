<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009"
		 xmlns:s="library://ns.adobe.com/flex/spark"
		 xmlns:mx="library://ns.adobe.com/flex/mx"
		 xmlns:scheduler="be.irail.betrains.playbook.view.scheduler.*"
		 xmlns:components="be.irail.betrains.playbook.view.components.*"
		 xmlns:stations="be.irail.betrains.playbook.view.stations.*"
		 xmlns:recent="be.irail.betrains.playbook.view.recent.*"
		 xmlns:favs="be.irail.betrains.playbook.view.favs.*"
		 xmlns:chat="be.irail.betrains.playbook.view.chat.*"
		 xmlns:traffic="be.irail.betrains.playbook.view.traffic.*"
		 width="100%"
		 height="100%">
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	<fx:Script>
		<![CDATA[
			import be.irail.betrains.playbook.controller.ModelLocator;
			import be.irail.betrains.playbook.view.about.AboutPopup;
			import be.irail.betrains.playbook.view.components.MainViewItem;

			import mx.core.FlexGlobals;
			import mx.core.IFlexDisplayObject;
			import mx.events.IndexChangedEvent;
			import mx.managers.PopUpManager;

			import qnx.locale.LocaleManager;

			import spark.events.IndexChangeEvent;

			[Bindable]
			private var _model:ModelLocator = ModelLocator.getInstance();

			private function applicationBar_changeHandler(event:IndexChangeEvent):void {
				if (event.newIndex != applicationBar.ABOUT_INDEX) {
					vs.selectedIndex = event.newIndex;
				} else {
					applicationBar.selectedIndex = event.oldIndex;
					var popup:IFlexDisplayObject = PopUpManager.createPopUp(FlexGlobals.topLevelApplication as DisplayObject, AboutPopup, true);
					PopUpManager.centerPopUp(popup);
				}
			}

			protected function vs_changeHandler(event:IndexChangedEvent):void {
				if (event.oldIndex > -1 && (event.oldIndex != applicationBar.ABOUT_INDEX)) {
					MainViewItem(NavigatorContent(vs.getElementAt(event.oldIndex)).getElementAt(0)).destroy();
				}

				if (event.newIndex > -1) {
					MainViewItem(NavigatorContent(vs.getElementAt(event.newIndex)).getElementAt(0)).make();
				}
			}
		]]>
	</fx:Script>

	<mx:ViewStack id="vs"
				  width="100%"
				  height="100%"
				  creationPolicy="all"
				  change="vs_changeHandler(event)">
		<s:NavigatorContent>
			<recent:RecentSchedulerQueries id="recent"
										   title="{LocaleManager.localeManager.getResource('recent.title')}"/>
		</s:NavigatorContent>
		<s:NavigatorContent>
			<favs:FavouritesView id="favourites"
								 favourites="{_model.favourites}"
								 title="{LocaleManager.localeManager.getResource('favs.title')}"/>
		</s:NavigatorContent>
		<s:NavigatorContent>
			<scheduler:SchedulerView id="scheduler"
									 title="{LocaleManager.localeManager.getResource('scheduler.title')}"/>
		</s:NavigatorContent>
		<s:NavigatorContent>
			<stations:StationsView id="stations"
								   title="{LocaleManager.localeManager.getResource('liveboard.title')}"/>
		</s:NavigatorContent>
		<s:NavigatorContent>
			<traffic:TrafficIssuesView id="works"/>
		</s:NavigatorContent>
		<s:NavigatorContent>
			<chat:ChatView id="chat"
						   title="{LocaleManager.localeManager.getResource('chat.title')}"/>
		</s:NavigatorContent>
	</mx:ViewStack>

	<components:ApplicationBar id="applicationBar"
							   left="0"
							   right="0"
							   bottom="0"
							   change="applicationBar_changeHandler(event)">
	</components:ApplicationBar>
</s:Group>
